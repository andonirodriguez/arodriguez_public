<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Andoni Rodriguez Personal Site</title>
    <meta charset="utf-8">
    <meta name="description" content="Andoni Rodriguez Personal Site" />
    <meta name="robots" content="index,follow">
    <!-- Open Graph Protocol Meta -->
    <meta property='og:title' content='Andoni Rodriguez - Personal Site' />
    <meta property='og:url' content='http://www.andonirodriguez.com' />
    <meta property='og:image' content='http://www.andonirodriguez.com/static/img/home-bg.jpg' />
    <meta property='og:type' content='website' />
    <meta property='og:description' content='Andoni Rodriguez - Personal Site' />
    <!-- END Open Graph Protocol Meta -->
    <!-- Twitter Cards -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Andoni Rodriguez - Personal Site" />
    <meta name="twitter:description" content="Andoni Rodriguez - Personal Site" />
    <meta name="twitter:url" content="http://www.andonirodriguez.com" />
    <meta name="twitter:image" content="http://www.andonirodriguez.com/static/img/home-bg.jpg" />
    <!-- END Twitter Cards -->


    <!-- Bootstrap Core CSS -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="/static/css/clean-blog.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Google Analytics -->
    <script src="/static/js/analyticstracking.js"></script>


</head>

<script id="mcjs">!function(c,h,i,m,p){m=c.createElement(h),p=c.getElementsByTagName(h)[0],m.async=1,m.src=i,p.parentNode.insertBefore(m,p)}(document,"script","https://chimpstatic.com/mcjs-connected/js/users/c797fd4414a2173ba89d1552d/dde80ea88a3aa58c45922e85d.js");</script>


    <!-- Page Header -->
    <header class="intro-header" style="background-image: url('/static/img/home-bg.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="site-heading">
                        <h2>Andoni Rodríguez</h2>
                        <hr class="small">
                        <span class="subheading">Articulos</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Andoni Rodríguez</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    <li>
                        <a href="/posts/">Articulos</a>
                    </li>
                    <li>
                        <a href="/projects/">Proyectos</a>
                    </li>
                    <li>
                        <a href="/contact/">Contacto</a>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>



    <!-- Post Content -->
    <article>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <h1>Django Rest Framework</h1>
                    <hr>
                    <h2 class="subheading">Tutorial. Cómo crear una API con Django Rest Framework</h2>
                    <p>Según su definición en Wikipedia una <a href="https://en.wikipedia.org/wiki/Application_programming_interface">API</a> es:</p>
<blockquote>
<p>In computer programming, an application programming interface (API) is a set of subroutine definitions, protocols, and 
tools for building application software. In general terms, it is a set of clearly defined methods of communication 
between various software components. A good API makes it easier to develop a computer program by providing all the 
building blocks, which are then put together by the programmer.</p>
</blockquote>
<p>El desarrollo de API's se ha convertido en los últimos años en una parte fundamental de la web. Con la aparición de
nuevos dispositivos, la necesidad de tener estandarizada y centralizada la forma en la que se consume información, se ha 
hecho más importante que nunca.</p>
<p>En mi trabajo he tenido la oportunidad de diseñar e implementar una <strong>API</strong> con Django Rest Framework ha sido una 
experiencia muy satisfactoria.</p>
<p>En esta ocasión, además de hacer un post explicando cómo montar una API con <strong>Django Rest Framework</strong>, tambien teneis
disponible un pequeño videotutorial.</p>
<iframe width="740" height="315" src="https://www.youtube.com/embed/akyIsv5xyBU" frameborder="0" allowfullscreen></iframe>

<h3>Herramientas</h3>
<p>Las herramientas que vamos a necesitar son las siguientes:</p>
<p><strong>Docker</strong>, para poder tener la API totalmente aislada y dentro de un contenedor, la terminal, para lanzar todos los comandos
necesarios y <strong>PyCharm</strong>, que lo vamos a usar como IDE de programación.</p>
<h3>Estructura y configuración</h3>
<p>Para poder empezar a desarrollar la <strong>API</strong> necesitamos configurar el proyecto de la siguiente forma:</p>
<p><code>$ docker-compose run --rm djangorest django-admin.py startproject drf_basics .</code></p>
<p>Esto generará un proyecto Django llamado <strong>'drf_basics'</strong>.</p>
<p><code>$ docker-compose run --rm djangorest python manage.py startapp superheroes</code></p>
<p>Posteriormente procedemos a la generación de ficheros para la aplicación, como en este caso va a ser una API de
superheroes, lo hemos llamado <strong>'superheroes'</strong>.</p>
<p>Después de ejecutar estos comandos, el directorio tendrá el siguiente aspecto:</p>
<pre>
⇒  ls 
Dockerfile
docker-compose.yml
drf_basics
manage.py
requirements.txt
superheroes
</pre>

<p>Se puede ver que hay 2 ficheros relacionados con <strong>Docker</strong>, no los voy a explicar por ser no ser la temática específica
del  post, pero contienen las definiciones necesarias para que la API pueda funcionar dentro de un contenedor.</p>
<blockquote>
<p>Siempre podéis echarle un vistazo a <a href="http://andonirodriguez.com/posts/docker_docker_compose/">este post sobre funcionamiento de Docker y docker-compose</a>,
en el cual hablo ampliamente de estos componentes.</p>
</blockquote>
<p>El fichero de '<strong>requirments.txt</strong>' es un fichero que contiene la paquetería python necesaria para que el proyecto pueda
funcionar. Los únicos paquetes que necesita la API son '<strong>django</strong>' y el propio '<strong>djangorestframework</strong>'.</p>
<pre>
django
djangorestframework
</pre>

<h3>Configuración del proyecto</h3>
<p>Dentro del directorio '<strong>drf_basics/settings.py</strong>' tenemos que agregar las siguientes líneas en la sección '<strong>INSTALLED_APPS</strong>'
para que el proyecto Django sepa qué módulos estamos usando:</p>
<pre>
    'rest_framework',
    'superheroes.apps.SuperheroesConfig'
</pre>

<p>'<strong>INSTALLED_APPS</strong>' quedaría de esta forma:</p>
<pre>
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'superheroes.apps.SuperheroesConfig'
]
</pre>

<h3>Modelos</h3>
<p>Los modelos mapean tablas de bases de datos en objetos Django. Para crearlos nos vamos al fichero '<strong>models.py</strong>' dentro
del directorio '<strong>superheroes</strong>' y agregamos lo siguiente:</p>
<pre>
class Publisher(models.Model):
    name = models.CharField(max_length=100, blank=True, default='')
    founder = models.CharField(max_length=100, blank=True, default='')

    class Meta:
        ordering = ('name',)


class SuperHeroe(models.Model):
    name = models.CharField(max_length=100, blank=True, default='')
    gender = models.CharField(max_length=100, blank=True, default='')
    real_name = models.CharField(max_length=100, blank=True, default='')
    publisher = models.ForeignKey(Publisher)

    class Meta:
        ordering = ('name',)

</pre>

<p>Con esto ya tenemos creados los modelos.</p>
<p>Para generar estos modelos en base de datos tenemos que lanzar los siguientes comandos:</p>
<p><code>$ docker-compose run --rm djangorest python manage.py makemigrations superheroes</code></p>
<p>Que generará un fichero de '<strong>migrations</strong>' con los modelos. Y posteriormente:</p>
<p><code>$ docker-compose run --rm djangorest python manage.py migrate</code></p>
<p>Que aplicará el fichero de migrations a una db <strong>sqlite3</strong>.</p>
<h3>Serializers</h3>
<p>Los serializers son la forma que tiene Django Rest de representar y validar los modelos en forma de objetos <strong>JSON</strong>.</p>
<p>Necesitamos crear un fichero '<strong>serializers.py</strong>' dentro del directorio '<strong>superheroes</strong>' y agregar las siguientes líneas:</p>
<pre>
class SuperHeroeSerializer(serializers.ModelSerializer):
    class Meta:
        model = SuperHeroe
        fields = ('id', 'name', 'gender', 'real_name', 'publisher')


class PublisherSerializer(serializers.ModelSerializer):
    class Meta:
        model = Publisher
        fields = ('id', 'name', 'founder')
</pre>

<p>Con esto los serializers estarían listos.</p>
<h3>Probando modelos/serializers</h3>
<p>Con los modelos y serializers creados podemos ir a la consola de python y agregar los primeros datos a la <strong>API</strong>.</p>
<p>Para acceder a la consola de python hacemos lo siguiente:</p>
<p><code>$ docker-compose run --rm djangorest python manage.py shell</code></p>
<p>Agregamos los primeros modelos de la siguiente forma:</p>
<pre>
from superheroes.models import Publisher, SuperHeroe
from superheroes.serializers import PublisherSerializer, SuperHeroeSerializer

marvel = Publisher(name="Marvel Comics", founder="Martin Goodman")
marvel.save()

hulk = SuperHeroe(name="Hulk", gender="male",real_name="Bruce Banner", publisher=marvel)
hulk.save()
</pre>

<p>Para ver una representación 'JSON' de los modelos basta con llamar a los serializers de la siguiente forma:</p>
<pre>
serializer = SuperHeroeSerializer(hulk)
serializer.data
</pre>

<p>Bien, nuestra pequeña base de datos de <strong>superheroes</strong> empieza a tener sus primeros registros :)</p>
<h3>Views</h3>
<p>Para poder pedir los datos que nos proporciona la combinación de modelos y serializers, necesitamos <strong>views</strong>.</p>
<p>En el fichero '<strong>superheroes/views.py</strong>' agregamos lo siguiente:</p>
<pre>
from superheroes.models import SuperHeroe, Publisher
from superheroes.serializers import SuperHeroeSerializer, PublisherSerializer
from rest_framework import generics


class SuperHeroeList(generics.ListCreateAPIView):
    queryset = SuperHeroe.objects.all()
    serializer_class = SuperHeroeSerializer


class SuperHeroeDetail(generics.RetrieveUpdateDestroyAPIView):
    queryset = SuperHeroe.objects.all()
    serializer_class = SuperHeroeSerializer


class PublisherList(generics.ListCreateAPIView):
    queryset = Publisher.objects.all()
    serializer_class = PublisherSerializer


class PublisherDetail(generics.RetrieveUpdateDestroyAPIView):
    queryset = Publisher.objects.all()
    serializer_class = PublisherSerializer
</pre>

<p>Para las views usamos las '<strong>mixed-in generic views</strong>' de <strong>Django Rest Framework</strong>, son sencillas y nos permiten cubrir todas
las necesidades para la <strong>API</strong> (GET, POST, UPDATE y DELETE).</p>
<h3>Routing</h3>
<p>Ha llegado la hora de enlazar todas las partes de la API con el routing, para lograr esto primero nos vamos al fichero
'<strong>drf_basics/urls.py</strong>' e incluimos las rutas de la app '<strong>superheroes</strong>' de la siguiente forma:</p>
<pre>
url(r'^', include('superheroes.urls')),
</pre>

<p>El fichero debería quedar así:</p>
<pre>
from django.conf.urls import url, include
from django.contrib import admin

urlpatterns = [
    url(r'^admin/', admin.site.urls),
    url(r'^', include('superheroes.urls')),

]
</pre>

<p>Y en el fichero '<strong>superheores/urls.py</strong>':</p>
<pre>
from django.conf.urls import url, include
from rest_framework.urlpatterns import format_suffix_patterns
from superheroes import views

urlpatterns = [
    url(r'^superheroe/$', views.SuperHeroeList.as_view()),
    url(r'^superheroe/(?P<pk>[0-9]+)/$', views.SuperHeroeDetail.as_view()),
    url(r'^publisher/$', views.PublisherList.as_view()),
    url(r'^publisher/(?P<pk>[0-9]+)/$', views.PublisherDetail.as_view()),
]

urlpatterns = format_suffix_patterns(urlpatterns)
</pre>

<p>Los '<strong>urlpatterns</strong>' sirven para que Django Rest Framework pueda encontrar las views asociadas a las expresiones
regulares definidas.</p>
<p>Bien! Con esto ya tenemos una <strong>API</strong> totalmente funcional y lista para ser usada.</p>
<h3>Probando la API</h3>
<p>Arrancamos la API de la siguiente forma:</p>
<p><code>$ docker-compose up</code></p>
<p>Si todo ha ido bien deberíamos poder probar la API en la siguientes <strong>URL's</strong>:</p>
<p>'<strong>http://127.0.0.1:8000/superheroe</strong>' </p>
<p><img class="img-responsive" src="/static/img/superheroe.png" alt="SuperHeroe API browseable"></p>
<p>O '<strong>http://127.0.0.1:8000/publisher</strong>'</p>
<p><img class="img-responsive" src="/static/img/publisher.png" alt="Publisher API browseable"></p>
<p>Es muy recomendable explorar las diferentes opciones que da la <strong>API navegable</strong> de Django Rest Framework.</p>
<p>Si quereis probar los verbos HTTP por terminal, recomiendo la herramienta <a href="https://github.com/jakubroztocil/httpie"><strong>httpie</strong></a>, 
para instalarla basta con:</p>
<p><code>$ pip install httpie</code></p>
<pre>
⇒  http --json GET http://127.0.0.1:8000/superheroe/
HTTP/1.0 200 OK
Allow: GET, POST, HEAD, OPTIONS
Content-Type: application/json
Server: WSGIServer/0.1 Python/2.7.13
Vary: Accept, Cookie
X-Frame-Options: SAMEORIGIN

[
    {
        "gender": "male",
        "id": 1,
        "name": "Hulk",
        "publisher": 1,
        "real_name": "Bruce Banner"
    },
    {
        "gender": "male",
        "id": 2,
        "name": "Iron Man",
        "publisher": 1,
        "real_name": "Tony Stark"
    }
]
</pre>

<p>De esta forma podemos probar en la terminal sin tener que recurrir al navegador.</p>
<h3>Conclusiones</h3>
<p>Es cierto que <strong>Django Rest Framework</strong> puede parecer al principio un poco complicado, pero a medida que se va ganando 
soltura esta sensación va desapareciendo.</p>
<p>Siempre podéis echarle un vistazo al proyecto en <a href="https://github.com/andonirodriguez/drf_basics">GitHub</a> y hacer las pruebas que queráis.</p>
<p>Espero que tanto el post como el videotutorial le puedan servir a alguien que quiera iniciarse en Django Rest Framework.</p>
<p>Un saludo.</p>
                    <p class="post-meta">
                        Por <strong><a href="/contact/">Andoni</a></strong> el <strong>14 de Marzo de 2017</strong>
                    </p>
                </div>
            </div>
        </div>
    </article>

    <hr>




    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                        <li>
                            <a href="https://twitter.com/AndoniRodriguez">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="https://www.linkedin.com/in/andonirodriguez">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="https://github.com/andonirodriguez">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="mailto:andoni.rodriguez@gmail.com">
                                <span class="fa-stack fa-lg">
                                    <i class="fa fa-circle fa-stack-2x"></i>
                                    <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                                </span>
                            </a>
                        </li>
                    </ul>
                    <p class="copyright text-muted">Copyright &copy; Andoni Rodríguez 2016</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/static/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/static/js/bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="/static/js/clean-blog.min.js"></script>

</body>
</html>
